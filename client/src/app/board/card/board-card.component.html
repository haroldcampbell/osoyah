<div
  class="card-body"
  role="button"
  tabindex="0"
  (click)="openDetails()"
  (keydown.enter)="openDetails()"
  (keydown.space)="openDetails()"
>
  @if (!isEditing) {
    <div class="card-title-row">
      <div class="card-title-text" data-testid="card-title">{{ card.title }}</div>
      <button
        type="button"
        class="card-edit-button"
        (click)="startTitleEdit($event)"
        aria-label="Edit card title"
        data-testid="card-edit-button"
      >
        <img src="assets/icons/pen-to-square.svg" alt="" aria-hidden="true" />
      </button>
    </div>
  } @else {
    <button
      type="button"
      class="card-edit-overlay"
      aria-label="Cancel card title edit"
      (click)="cancelTitleEdit(); $event.stopPropagation()"
    ></button>
    <div
      class="card-edit-modal"
      role="dialog"
      aria-label="Edit card title"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown.enter)="$event.stopPropagation()"
      (keydown.space)="$event.stopPropagation()"
    >
      <label class="card-edit-label" [attr.for]="'card-title-input-' + card.id">
        Card title
      </label>
      <input
        #titleInput
        [id]="'card-title-input-' + card.id"
        type="text"
        class="card-title-input"
        placeholder="Card title"
        [(ngModel)]="boardService.editingCardTitle"
        (input)="handleTitleInput()"
        (keyup.enter)="saveTitleEdit()"
        (keyup.escape)="cancelTitleEdit()"
        data-testid="card-title-input"
      />
      @if (titleError) {
        <div class="card-title-error" data-testid="card-title-error">{{ titleError }}</div>
      }
      <div class="card-edit-actions">
        <button
          type="button"
          class="card-edit-secondary"
          (click)="cancelTitleEdit(); $event.stopPropagation()"
          data-testid="card-edit-cancel"
        >
          Cancel
        </button>
        <button
          type="button"
          class="card-edit-primary"
          (click)="saveTitleEdit(); $event.stopPropagation()"
          data-testid="card-edit-save"
        >
          Save
        </button>
      </div>
    </div>
  }
  <div class="card-meta" data-testid="card-meta">
    @if (card.description.trim()) {
      <span
        class="card-meta-item card-meta-detail"
        data-testid="card-meta-description"
        aria-label="Details"
        title="Details"
      >
        <img
          class="card-meta-detail-icon"
          src="assets/icons/file-lines.svg"
          alt=""
          aria-hidden="true"
        />
      </span>
      <span class="card-meta-separator">•</span>
    }
    <span class="card-meta-item" data-testid="card-meta-comments">
      {{ card.comments.length }} comment{{ card.comments.length === 1 ? '' : 's' }}
    </span>
    <span class="card-meta-separator">•</span>
    <span
      class="card-meta-item"
      data-testid="card-meta-activity"
      [title]="boardService.getLastActivityTooltip(card)"
    >
      {{ boardService.formatRelativeTime(boardService.getLastActivityIso(card)) }}
    </span>
  </div>
</div>
