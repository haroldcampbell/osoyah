<div
  class="card-body"
  role="button"
  tabindex="0"
  (click)="openDetails()"
  (keydown.enter)="openDetails()"
  (keydown.space)="openDetails()"
>
  @if (!isEditing) {
    <div class="card-title-row">
      <button
        type="button"
        class="card-title-button"
        (click)="startTitleEdit($event)"
        (keydown.enter)="startTitleEdit($event)"
        (keydown.space)="startTitleEdit($event)"
        data-testid="card-title"
      >
        {{ card.title }}
      </button>
    </div>
  } @else {
    <div class="card-title-row">
      <input
        #titleInput
        type="text"
        class="card-title-input"
        placeholder="Card title"
        [(ngModel)]="boardService.editingCardTitle"
        (blur)="cancelTitleEdit()"
        (keyup.enter)="saveTitleEdit()"
        (keyup.escape)="cancelTitleEdit()"
        data-testid="card-title-input"
      />
    </div>
  }
  <div class="card-meta" data-testid="card-meta">
    @if (card.description.trim()) {
      <span
        class="card-meta-item card-meta-detail"
        data-testid="card-meta-description"
        aria-label="Details"
        title="Details"
      >
        <img
          class="card-meta-detail-icon"
          src="assets/icons/file-lines.svg"
          alt=""
          aria-hidden="true"
        />
      </span>
      <span class="card-meta-separator">•</span>
    }
    <span class="card-meta-item" data-testid="card-meta-comments">
      {{ card.comments.length }} comment{{ card.comments.length === 1 ? '' : 's' }}
    </span>
    <span class="card-meta-separator">•</span>
    <span
      class="card-meta-item"
      data-testid="card-meta-activity"
      [title]="boardService.getLastActivityTooltip(card)"
    >
      {{ boardService.formatRelativeTime(boardService.getLastActivityIso(card)) }}
    </span>
  </div>
</div>
