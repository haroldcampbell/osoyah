<header class="list-header">
  @if (!isEditingList) {
    <div class="list-title-row">
      <div class="list-title-handle" cdkDragHandle data-testid="list-handle">
        <button
          type="button"
          class="list-title-button"
          (click)="startTitleEdit($event)"
          (keydown.enter)="startTitleEdit($event)"
          (keydown.space)="startTitleEdit($event)"
          data-testid="list-title"
        >
          {{ list.title }}
        </button>
      </div>
      <details class="list-menu" #listMenu>
        <summary class="list-menu-button" aria-label="List actions" data-testid="list-menu">
          <span class="list-menu-icon" aria-hidden="true"></span>
        </summary>
        <div class="list-menu-popover">
          <button type="button" (click)="requestRemoveList()" data-testid="remove-list">
            Remove
          </button>
        </div>
      </details>
    </div>
  } @else {
    <div class="list-title-row">
      <input
        #titleInput
        type="text"
        class="list-title-input"
        [(ngModel)]="boardService.editingListTitle"
        (blur)="cancelTitleEdit()"
        (keyup.enter)="saveTitleEdit()"
        (keyup.escape)="cancelTitleEdit()"
        data-testid="list-title-input"
      />
    </div>
  }
</header>

<div
  class="cards"
  cdkDropList
  [id]="list.id"
  [cdkDropListConnectedTo]="boardService.cardDropListIds"
  [cdkDropListData]="list.cardIds"
  (cdkDropListDropped)="boardService.dropCard($event)"
  data-testid="card-dropzone"
  [attr.data-list-id]="list.id"
>
  @for (cardId of list.cardIds; track cardId) {
    @if (boardService.getCard(cardId); as card) {
      <app-board-card
        cdkDrag
        data-testid="card"
        [attr.data-card-id]="card.id"
        [class.card-selected]="boardService.selectedCard?.cardId === card.id"
        [card]="card"
        [list]="list"
      ></app-board-card>
    }
  }

  @if (list.cardIds.length === 0) {
    <div class="empty-cards">No cards yet.</div>
  }
</div>

<div class="add-card">
  <input
    type="text"
    placeholder="Add a card"
    [(ngModel)]="newCardTitle"
    (keyup.enter)="requestAddCard()"
    data-testid="add-card-input"
    [attr.data-list-id]="list.id"
  />
  <button type="button" (click)="requestAddCard()" data-testid="add-card-button">Add card</button>
</div>
